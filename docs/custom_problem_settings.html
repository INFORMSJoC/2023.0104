<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom problem settings &mdash; RoutingBlocks 01.04.2023 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=7f9d500d"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Problem instance" href="instance.html" />
    <link rel="prev" title="Custom operators" href="custom_operators.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            RoutingBlocks
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_operators.html">Custom operators</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Custom problem settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prototyping-in-python">Prototyping in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#label-and-data-classes">Label and data classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-evaluation-class">The evaluation class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-native-extension">Writing a native extension</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instance.html">Problem instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="solution.html">Solution representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluation.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="localsearch.html">Local search</a></li>
<li class="toctree-l1"><a class="reference internal" href="exact_facility_placement.html">Exact replenishment facility placement</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaheuristic_components.html">Metaheuristic components</a></li>
<li class="toctree-l1"><a class="reference internal" href="auxilliary.html">Auxiliary algorithms and data structures</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Problem settings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adptw.html">ADPTW</a></li>
<li class="toctree-l1"><a class="reference internal" href="niftw.html">NIFTW</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Reading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="alternatives.html">Alternatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution opportunities</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="full_api.html">Routingblocks class index</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RoutingBlocks</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Custom problem settings</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/custom_problem_settings.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-problem-settings">
<span id="id1"></span><h1>Custom problem settings<a class="headerlink" href="#custom-problem-settings" title="Link to this heading"></a></h1>
<section id="prototyping-in-python">
<h2>Prototyping in Python<a class="headerlink" href="#prototyping-in-python" title="Link to this heading"></a></h2>
<p>So far, the example developed in the previous sections is limited to the EVRP-TW-PR. However, the library is designed to be easily extensible to other problem settings. This requires implementing five interfaces:</p>
<ul class="simple">
<li><p>VertexData: Holds the data associated with a vertex</p></li>
<li><p>ArcData: Holds the data associated with an arc</p></li>
<li><p>ForwardLabel: Holds the forward label of a vertex</p></li>
<li><p>BackwardLabel: Holds the backward label of a vertex</p></li>
<li><p>Evaluation: Implements the main labeling and evaluation logic</p></li>
</ul>
<section id="label-and-data-classes">
<h3>Label and data classes<a class="headerlink" href="#label-and-data-classes" title="Link to this heading"></a></h3>
<p>Implementing VertexData, ArcData, and Label classes is straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CVRPVertexData</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demand</span> <span class="o">=</span> <span class="n">demand</span>


<span class="k">class</span> <span class="nc">CVRPArcData</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>


<span class="k">class</span> <span class="nc">CVRPForwardLabel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">load</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">load</span>

<span class="k">class</span> <span class="nc">CVRPBackwardLabel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">load</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">load</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example above effectively duplicates the code for CVRPForwardLabel and CVRPBackwardLabel. There is no requirement for distinct ForwardLabel and BackwardLabel classes, i.e., we could replace these with a single CVRPLabel class. For the sake of clarity, we keep them separate in this example.</p>
</div>
</section>
<section id="the-evaluation-class">
<h3>The evaluation class<a class="headerlink" href="#the-evaluation-class" title="Link to this heading"></a></h3>
<p>Having defined the data and label classes holding problem-specific data, we can now implement the evaluation class.
RoutingBlocks provides two interfaces for this purpose (cf. <a class="reference internal" href="evaluation.html#evaluation"><span class="std std-ref">Evaluation</span></a>):</p>
<ul class="simple">
<li><p><a class="reference internal" href="evaluation.html#routingblocks.PyEvaluation" title="routingblocks.PyEvaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PyEvaluation</span></code></a>: General evaluation class. Receives the full route, i.e., all concatenated route segments, for cost evaluation. This is the most general interface</p></li>
<li><p><a class="reference internal" href="evaluation.html#routingblocks.PyConcatenationBasedEvaluation" title="routingblocks.PyConcatenationBasedEvaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PyConcatenationBasedEvaluation</span></code></a>: Evaluation class for problems with constant time, i.e., concatenation-based, evaluation. Provided for convenience, i.e., to provide a simple, more efficient interface for these special cases</p></li>
</ul>
<p>As constant-time evaluation is possible for the CVRP, we implement the <a class="reference internal" href="evaluation.html#routingblocks.PyConcatenationBasedEvaluation" title="routingblocks.PyConcatenationBasedEvaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PyConcatenationBasedEvaluation</span></code></a> interface in the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a type alias for conciseness. Note: This is not required.</span>
<span class="n">CVRPLabel</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">CVRPForwardLabel</span><span class="p">,</span> <span class="n">CVRPBackwardLabel</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">CVRPEvaluation</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">PyConcatenationBasedEvaluation</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_capacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">rb</span><span class="o">.</span><span class="n">PyConcatenationBasedEvaluation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_capacity</span> <span class="o">=</span> <span class="n">storage_capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_penalty</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="k">def</span> <span class="nf">_compute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">load</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="c1"># Helper function to compute the cost of a label.</span>
        <span class="k">return</span> <span class="n">distance</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_penalty</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">load</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage_capacity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">CVRPLabel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_cost</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_cost_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">CVRPLabel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">load</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fwd</span><span class="p">:</span> <span class="n">CVRPForwardLabel</span><span class="p">,</span> <span class="n">bwd</span><span class="p">:</span> <span class="n">CVRPBackwardLabel</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_cost</span><span class="p">(</span><span class="n">fwd</span><span class="o">.</span><span class="n">distance</span> <span class="o">+</span> <span class="n">bwd</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">fwd</span><span class="o">.</span><span class="n">load</span> <span class="o">+</span> <span class="n">bwd</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_backward_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CVRPBackwardLabel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CVRPBackwardLabel</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_forward_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CVRPForwardLabel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CVRPForwardLabel</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">CVRPLabel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">load</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage_capacity</span>

    <span class="k">def</span> <span class="nf">propagate_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">succ_label</span><span class="p">:</span> <span class="n">CVRPBackwardLabel</span><span class="p">,</span> <span class="n">succ_vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span>
                           <span class="n">vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">arc</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Arc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CVRPBackwardLabel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CVRPBackwardLabel</span><span class="p">(</span><span class="n">succ_label</span><span class="o">.</span><span class="n">distance</span> <span class="o">+</span> <span class="n">arc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">succ_label</span><span class="o">.</span><span class="n">load</span> <span class="o">+</span> <span class="n">succ_vertex</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">propagate_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_label</span><span class="p">:</span> <span class="n">CVRPForwardLabel</span><span class="p">,</span> <span class="n">pred_vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span>
                          <span class="n">vertex</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">arc</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Arc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CVRPForwardLabel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CVRPForwardLabel</span><span class="p">(</span><span class="n">pred_label</span><span class="o">.</span><span class="n">distance</span> <span class="o">+</span> <span class="n">arc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">pred_label</span><span class="o">.</span><span class="n">load</span> <span class="o">+</span> <span class="n">vertex</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Calls to vertex.data and arc.data are not type-safe: they work only if the vertex and arc data types have been defined in python. This is a tradeoff between performance and safety.</p>
</div>
<p>Theses classes can now be used in place of the ones provided by out of the box. In fact, using the solver developed in the <a class="reference internal" href="getting_started.html#alns-extension"><span class="std std-ref">previous sections</span></a> (<a class="reference external" href="https://github.com/tumBAIS/RoutingBlocks/tree/main/examples/alns">source code</a>),
we can solve the CVRP by simply swapping the evaluation class and creating the corresponding CVRPData classes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">create_instance</span><span class="p">(</span><span class="n">serialized_vertices</span><span class="p">,</span> <span class="n">serialized_arcs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rb</span><span class="o">.</span><span class="n">Instance</span><span class="p">:</span>
<span class="hll"><span class="linenos"> 2</span>    <span class="n">instance_builder</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">InstanceBuilder</span><span class="p">()</span>
</span><span class="linenos"> 3</span>    <span class="c1"># Create and register the vertices</span>
<span class="linenos"> 4</span>    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">serialized_vertices</span><span class="p">:</span>
<span class="linenos"> 5</span>        <span class="c1"># Create problem-specific data held by vertices</span>
<span class="hll"><span class="linenos"> 6</span>        <span class="n">vertex_data</span> <span class="o">=</span> <span class="n">CVRPVertexData</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">])</span>
</span><span class="linenos"> 7</span>        <span class="c1"># Register the vertex depending on it&#39;s type</span>
<span class="linenos"> 8</span>        <span class="k">if</span> <span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
<span class="linenos"> 9</span>            <span class="n">instance_builder</span><span class="o">.</span><span class="n">set_depot</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;StringID&#39;</span><span class="p">],</span> <span class="n">vertex_data</span><span class="p">)</span>
<span class="linenos">10</span>        <span class="k">elif</span> <span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
<span class="linenos">11</span>            <span class="n">instance_builder</span><span class="o">.</span><span class="n">add_customer</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;StringID&#39;</span><span class="p">],</span> <span class="n">vertex_data</span><span class="p">)</span>
<span class="linenos">12</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="n">instance_builder</span><span class="o">.</span><span class="n">add_station</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;StringID&#39;</span><span class="p">],</span> <span class="n">vertex_data</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># Create and register the arcs</span>
<span class="linenos">16</span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">serialized_arcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">17</span>        <span class="c1"># Create problem-specific data held by arcs</span>
<span class="linenos">18</span>        <span class="n">arc_data</span> <span class="o">=</span> <span class="n">CVRPArcData</span><span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">])</span>
<span class="hll"><span class="linenos">19</span>        <span class="n">instance_builder</span><span class="o">.</span><span class="n">add_arc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">arc_data</span><span class="p">)</span>
</span><span class="linenos">20</span>
<span class="linenos">21</span>    <span class="c1"># Create instance</span>
<span class="linenos">22</span>    <span class="k">return</span> <span class="n">instance_builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c1"># ...</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">def</span> <span class="nf">alns</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Instance</span><span class="p">,</span> <span class="n">vehicle_storage_capacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="linenos">27</span>         <span class="n">number_of_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">min_vertex_removal_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
<span class="linenos">28</span>         <span class="n">max_vertex_removal_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">):</span>
<span class="hll"><span class="linenos">29</span>    <span class="n">evaluation</span> <span class="o">=</span> <span class="n">CVRPEvaluation</span><span class="p">(</span><span class="n">vehicle_storage_capacity</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">30</span>    <span class="n">evaluation</span><span class="o">.</span><span class="n">load_penalty</span> <span class="o">=</span> <span class="mf">1000.0</span>
</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We recommend implementing a custom Evaluation class by extending the native RoutingBlocks library instead of providing a Python implementation for code used beyond prototyping.</p>
</div>
</section>
</section>
<section id="writing-a-native-extension">
<h2>Writing a native extension<a class="headerlink" href="#writing-a-native-extension" title="Link to this heading"></a></h2>
<p>Pure Python-based implementations of <a class="reference internal" href="evaluation.html#routingblocks.PyEvaluation" title="routingblocks.PyEvaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PyEvaluation</span></code></a>, <a class="reference internal" href="evaluation.html#routingblocks.PyConcatenationBasedEvaluation" title="routingblocks.PyConcatenationBasedEvaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PyConcatenationBasedEvaluation</span></code></a>, and <a class="reference internal" href="exact_facility_placement.html#routingblocks.Propagator" title="routingblocks.Propagator"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.Propagator</span></code></a> classes suffer from a significant performance penalty. This is due to the fact that parts of the library provided in native code need to return control to python interpreter for every evaluation.
To avoid this, the library provides native extension interfaces for all of it’s runtime critical components.
We provide an example of how to port the CVRP example to native code <a class="reference external" href="https://github.com/tumBAIS/routingblocks-native-extension-example">here</a>.
Specifically, the repository provides the necessary boilerplate code for building, dependency management, packaging, publishing, and installation of custom native extensions.
We ask users to consider publishing their native extensions on PyPI to make them available to the community.</p>
<p>The source code of <a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.adptw.Evaluation</span></code></a> (<a class="reference external" href="https://github.com/tumBAIS/RoutingBlocks/blob/develop/native/src/ADPTWEvaluation.cpp">native/src/ADPTWEvaluation.cpp</a>), <a class="reference internal" href="niftw.html#routingblocks.niftw.Evaluation" title="routingblocks.niftw.Evaluation"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.niftw.Evaluation</span></code></a> (<a class="reference external" href="https://github.com/tumBAIS/RoutingBlocks/blob/develop/native/src/NIFTWEvaluation.cpp">native/src/NIFTWEvaluation.cpp</a>), <a class="reference internal" href="adptw.html#routingblocks.adptw.FacilityPlacementOptimizer" title="routingblocks.adptw.FacilityPlacementOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.adptw.FacilityPlacementOptimizer</span></code></a> (<a class="reference external" href="https://github.com/tumBAIS/RoutingBlocks/blob/develop/native/include/routingblocks/ADPTWEvaluation.h">native/include/routingblocks/ADPTWEvaluation.h</a>), and <a class="reference internal" href="niftw.html#routingblocks.niftw.FacilityPlacementOptimizer" title="routingblocks.niftw.FacilityPlacementOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.niftw.FacilityPlacementOptimizer</span></code></a> (<a class="reference external" href="https://github.com/tumBAIS/RoutingBlocks/blob/develop/native/include/routingblocks/NIFTWEvaluation.h">native/include/routingblocks/NIFTWEvaluation.h</a>) provides further examples.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="custom_operators.html" class="btn btn-neutral float-left" title="Custom operators" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="instance.html" class="btn btn-neutral float-right" title="Problem instance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 - 2023, Patrick Sean Klein.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>