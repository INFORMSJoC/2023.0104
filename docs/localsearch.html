<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Local search &mdash; RoutingBlocks 01.04.2023 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=7f9d500d"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Exact replenishment facility placement" href="exact_facility_placement.html" />
    <link rel="prev" title="Evaluation" href="evaluation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            RoutingBlocks
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_operators.html">Custom operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_problem_settings.html">Custom problem settings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="instance.html">Problem instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="solution.html">Solution representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluation.html">Evaluation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Local search</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#local-search-solver">Local search solver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.LocalSearch"><code class="docutils literal notranslate"><span class="pre">LocalSearch</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.LocalSearch.optimize"><code class="docutils literal notranslate"><span class="pre">LocalSearch.optimize()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#operators">Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.InsertStationOperator"><code class="docutils literal notranslate"><span class="pre">InsertStationOperator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.RemoveStationOperator"><code class="docutils literal notranslate"><span class="pre">RemoveStationOperator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.InterRouteTwoOptOperator"><code class="docutils literal notranslate"><span class="pre">InterRouteTwoOptOperator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_0_1"><code class="docutils literal notranslate"><span class="pre">SwapOperator_0_1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_0_2"><code class="docutils literal notranslate"><span class="pre">SwapOperator_0_2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_0_3"><code class="docutils literal notranslate"><span class="pre">SwapOperator_0_3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_1_1"><code class="docutils literal notranslate"><span class="pre">SwapOperator_1_1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_1_2"><code class="docutils literal notranslate"><span class="pre">SwapOperator_1_2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_1_3"><code class="docutils literal notranslate"><span class="pre">SwapOperator_1_3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_2_1"><code class="docutils literal notranslate"><span class="pre">SwapOperator_2_1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_2_2"><code class="docutils literal notranslate"><span class="pre">SwapOperator_2_2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_2_3"><code class="docutils literal notranslate"><span class="pre">SwapOperator_2_3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_3_1"><code class="docutils literal notranslate"><span class="pre">SwapOperator_3_1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_3_2"><code class="docutils literal notranslate"><span class="pre">SwapOperator_3_2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.operators.SwapOperator_3_3"><code class="docutils literal notranslate"><span class="pre">SwapOperator_3_3</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-local-search-operators">Custom Local Search Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.LocalSearchOperator"><code class="docutils literal notranslate"><span class="pre">LocalSearchOperator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.LocalSearchOperator.finalize_search"><code class="docutils literal notranslate"><span class="pre">LocalSearchOperator.finalize_search()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.LocalSearchOperator.find_next_improving_move"><code class="docutils literal notranslate"><span class="pre">LocalSearchOperator.find_next_improving_move()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.LocalSearchOperator.prepare_search"><code class="docutils literal notranslate"><span class="pre">LocalSearchOperator.prepare_search()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.Move"><code class="docutils literal notranslate"><span class="pre">Move</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.Move.apply"><code class="docutils literal notranslate"><span class="pre">Move.apply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.Move.get_cost_delta"><code class="docutils literal notranslate"><span class="pre">Move.get_cost_delta()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pivoting-rules">Pivoting rules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.BestImprovementPivotingRule"><code class="docutils literal notranslate"><span class="pre">BestImprovementPivotingRule</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.KBestImprovementPivotingRule"><code class="docutils literal notranslate"><span class="pre">KBestImprovementPivotingRule</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.FirstImprovementPivotingRule"><code class="docutils literal notranslate"><span class="pre">FirstImprovementPivotingRule</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-pivoting-rules">Custom pivoting rules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#routingblocks.PivotingRule"><code class="docutils literal notranslate"><span class="pre">PivotingRule</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.PivotingRule.select_move"><code class="docutils literal notranslate"><span class="pre">PivotingRule.select_move()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#routingblocks.PivotingRule.continue_search"><code class="docutils literal notranslate"><span class="pre">PivotingRule.continue_search()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="exact_facility_placement.html">Exact replenishment facility placement</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaheuristic_components.html">Metaheuristic components</a></li>
<li class="toctree-l1"><a class="reference internal" href="auxilliary.html">Auxiliary algorithms and data structures</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Problem settings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adptw.html">ADPTW</a></li>
<li class="toctree-l1"><a class="reference internal" href="niftw.html">NIFTW</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Reading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="alternatives.html">Alternatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution opportunities</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="full_api.html">Routingblocks class index</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RoutingBlocks</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Local search</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/localsearch.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="local-search">
<h1>Local search<a class="headerlink" href="#local-search" title="Link to this heading"></a></h1>
<p>Local search is a core component of almost every state-of-the-art metaheuristic designed for vehicle routing problems.
RoutingBlocks provides a <a class="reference internal" href="#local-search-solver"><span class="std std-ref">local search solver</span></a>, a set of local search operators, and a set of <a class="reference internal" href="#pivoting-rules"><span class="std std-ref">pivoting rules</span></a>
that can be used to implement customized local search procedures. It is possible to implement custom local search operators and pivoting rules.</p>
<section id="local-search-solver">
<span id="id1"></span><h2>Local search solver<a class="headerlink" href="#local-search-solver" title="Link to this heading"></a></h2>
<p>The local search solver optimizes a given solution by applying a set of local search operators until no further
improvement is possible. Operators model iterators over the neighborhood of a solution. Specifically, on each invocation, an operator generates the (next) improving <a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.Move</span></code></a>. Moves provide apply and evaluation interfaces, that allow to apply the move to a solution and to evaluate the resulting solution, respectively.</p>
<p>The solver can be configured with a pivoting rule (e.g. <a class="reference internal" href="#routingblocks.BestImprovementPivotingRule" title="routingblocks.BestImprovementPivotingRule"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.BestImprovementPivotingRule</span></code></a>, <a class="reference internal" href="#routingblocks.KBestImprovementPivotingRule" title="routingblocks.KBestImprovementPivotingRule"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.KBestImprovementPivotingRule</span></code></a>, or <a class="reference internal" href="#routingblocks.FirstImprovementPivotingRule" title="routingblocks.FirstImprovementPivotingRule"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.FirstImprovementPivotingRule</span></code></a>) to select the next move to be applied to the solution. The following flowchart illustrates the control flow of the local search solver:</p>
<figure class="align-center" id="id4">
<div class="mermaid">
                flowchart TD
        A[&quot;optimize(..., operators)&quot;] --&gt; MAINLOOP[&quot;Find improving moves&quot;]

        MAINLOOP --&gt; ITER[&quot;Explore neighborhoods&quot;]

        ITER --&gt; |&quot;operator in operators&quot;| PREPARE[&quot;operator.prepare_search(...)&quot;]
        PREPARE --&gt; FIND_IMPROV[&quot;operator.find_next_improving_move(...)&quot;]

        FIND_IMPROV --&gt; |Move is not None| VALIDATE[&quot;validate move&quot;]
        FIND_IMPROV --&gt;|Move is None| FINALIZE[&quot;operator.finalize_search(...)&quot;]

        VALIDATE --&gt;|Move is None| FIND_IMPROV
        VALIDATE --&gt; |Move is not None| PIVOT[&quot;pivoting_rule.continue_search(Move, ...)&quot;]

        PIVOT --&gt; |false| FINALIZE
        PIVOT --&gt; |true| FIND_IMPROV

        FINALIZE --&gt; |&quot;operators remain and search was not aborted&quot;| ITER
        FINALIZE --&gt; |&quot;otherweise&quot;| SELECT_MOVE[&quot;pivoting_rule.select_move(...)&quot;]
        SELECT_MOVE --&gt; |&quot;Move is not None&quot;| APPLY[&quot;Apply move&quot;]

        APPLY --&gt; |Look for next improving move| MAINLOOP
        SELECT_MOVE --&gt; |&quot;Move is None&quot;| ABORT[&quot;Terminate local search&quot;]
        </div><figcaption>
<p><span class="caption-text">Control flow of the local search solver</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The primary loop of the local search (<em>Find improving moves</em>) algorithm can be found in <a class="reference internal" href="#routingblocks.LocalSearch.optimize" title="routingblocks.LocalSearch.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.LocalSearch.optimize()</span></code></a>. In each iteration, the loop identifies an improvement by investigating the neighboring solutions of the current one, and applies the selected move. The loop concludes when no further improvements are discovered.</p>
<p>A nested loop is utilized to explore neighborhoods (<em>Explore neighborhoods</em>), iterating over all operators provided in routingblocks.LocalSearch.optimize to examine the current solution’s neighboring solutions for each operator. At this point, the <a class="reference internal" href="#routingblocks.LocalSearchOperator.prepare_search" title="routingblocks.LocalSearchOperator.prepare_search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.LocalSearchOperator.prepare_search()</span></code></a> method initializes the operator. Following that, the <a class="reference internal" href="#routingblocks.LocalSearchOperator.find_next_improving_move" title="routingblocks.LocalSearchOperator.find_next_improving_move"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.LocalSearchOperator.find_next_improving_move()</span></code></a> method is invoked to locate the subsequent improvement. If no improvement is found, the <a class="reference internal" href="#routingblocks.LocalSearchOperator.finalize_search" title="routingblocks.LocalSearchOperator.finalize_search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.LocalSearchOperator.finalize_search()</span></code></a> method finalizes the operator. If an improvement is discovered, it is then validated using the exact evaluation given to the solver. The search for improvements continues if the move is deemed invalid. If valid, the pivoting rule determines whether the search should proceed or end.</p>
<p>After the nested loop concludes — either due to all operators being exhausted or the pivoting rule deciding to terminate the search — the <a class="reference internal" href="#routingblocks.PivotingRule.select_move" title="routingblocks.PivotingRule.select_move"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.PivotingRule.select_move()</span></code></a> method selects the following move to be implemented on the solution. If no move is chosen, the local search ends. If a move is selected, it is applied to the solution, and the primary loop restarts.</p>
<p>The interface of the local search solver is as follows:</p>
<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.LocalSearch">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">LocalSearch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="instance.html#routingblocks.Instance" title="routingblocks.Instance"><span class="pre">Instance</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">evaluation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><span class="pre">Evaluation</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">exact_evaluation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><span class="pre">Evaluation</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pivoting_rule</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#routingblocks.PivotingRule" title="routingblocks.PivotingRule"><span class="pre">PivotingRule</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.LocalSearch" title="Link to this definition"></a></dt>
<dd><p>This class implements a customizable local search algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instance</strong> (<a class="reference internal" href="instance.html#routingblocks.Instance" title="routingblocks.Instance"><em>Instance</em></a>) – </p></li>
<li><p><strong>evaluation</strong> (<a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><em>Evaluation</em></a>) – </p></li>
<li><p><strong>exact_evaluation</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><em>Evaluation</em></a><em>]</em>) – </p></li>
<li><p><strong>pivoting_rule</strong> (<a class="reference internal" href="#routingblocks.PivotingRule" title="routingblocks.PivotingRule"><em>PivotingRule</em></a>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.LocalSearch.optimize">
<span class="sig-name descname"><span class="pre">optimize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">operators</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#routingblocks.LocalSearchOperator" title="routingblocks.LocalSearchOperator"><span class="pre">LocalSearchOperator</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.LocalSearch.optimize" title="Link to this definition"></a></dt>
<dd><p>Searches the neighborhood of the solution for improving moves and applies them until no further improvement is possible.
The neighborhood is defined by the passed operators. Modifies the passed solution in-place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution to be improved.</p></li>
<li><p><strong>operators</strong> (<em>List</em><em>[</em><a class="reference internal" href="#routingblocks.LocalSearchOperator" title="routingblocks.LocalSearchOperator"><em>LocalSearchOperator</em></a><em>]</em>) – The operators to use for searching the neighborhood.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="operators">
<h2>Operators<a class="headerlink" href="#operators" title="Link to this heading"></a></h2>
<p>Operators generate moves that improve the passed solution. Moves (cf. <a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.Move</span></code></a>) provide apply and evaluation interfaces, that allow to apply the move to a solution and to evaluate the resulting solution, respectively.</p>
<p>The routingblocks package provides a set of local search operators:</p>
<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.InsertStationOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">InsertStationOperator</span></span><a class="headerlink" href="#routingblocks.operators.InsertStationOperator" title="Link to this definition"></a></dt>
<dd><p>Considers station insertions between consecutive vertices.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.RemoveStationOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">RemoveStationOperator</span></span><a class="headerlink" href="#routingblocks.operators.RemoveStationOperator" title="Link to this definition"></a></dt>
<dd><p>Considers station removals between consecutive vertices.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.InterRouteTwoOptOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">InterRouteTwoOptOperator</span></span><a class="headerlink" href="#routingblocks.operators.InterRouteTwoOptOperator" title="Link to this definition"></a></dt>
<dd><p>Considers two-opt moves between distinct routes. Tries to integrate the generator arc into the solution.</p>
</dd></dl>

<p>RoutingBlocks provies a set of generic swap operators that implement relocate and exchange moves.
The operators follow the following naming convention:
<code class="docutils literal notranslate"><span class="pre">SwapOperator_&lt;i&gt;_&lt;j&gt;</span></code> generates all moves that swap segments of length <code class="docutils literal notranslate"><span class="pre">i</span></code> with segments of length <code class="docutils literal notranslate"><span class="pre">j</span></code>.
The operator considers Inter- and Intra-route moves. Each operator can be configured to explore a granular neighborhood,
i.e. to consider only a subset of arcs, by passing a <code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.ArcSet</span></code> to the constructor.</p>
<p>The following operators are available:</p>
<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_0_1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_0_1</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_0_1" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_0_2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_0_2</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_0_2" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_0_3">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_0_3</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_0_3" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_1_1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_1_1</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_1_1" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_1_2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_1_2</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_1_2" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_1_3">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_1_3</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_1_3" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_2_1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_2_1</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_2_1" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_2_2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_2_2</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_2_2" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_2_3">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_2_3</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_2_3" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_3_1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_3_1</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_3_1" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_3_2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_3_2</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_3_2" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.operators.SwapOperator_3_3">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.operators.</span></span><span class="sig-name descname"><span class="pre">SwapOperator_3_3</span></span><a class="headerlink" href="#routingblocks.operators.SwapOperator_3_3" title="Link to this definition"></a></dt>
<dd><p>Swap operator. Swaps a segment of customers from a route to another route.</p>
</dd></dl>

</section>
<section id="custom-local-search-operators">
<span id="local-search-custom-operators"></span><h2>Custom Local Search Operators<a class="headerlink" href="#custom-local-search-operators" title="Link to this heading"></a></h2>
<p>Implementing a custom local search operators requires to implement two classes. One that extends the <a class="reference internal" href="#routingblocks.LocalSearchOperator" title="routingblocks.LocalSearchOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.LocalSearchOperator</span></code></a>, and one that extends the <a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.Move</span></code></a> interface.
The example below implements a custom operator that inserts depot visits, splitting routes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SplitRouteMove</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Move</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits a route into two routes. The passed location will be the first node of the second route.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">NodeLocation</span><span class="p">):</span>
        <span class="n">rb</span><span class="o">.</span><span class="n">Move</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Instance</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Solution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Create a new route</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">add_route</span><span class="p">()</span>
        <span class="n">new_route_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Swap the segment [location.position, end] of the route to be split with an empty segment of the new route</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">exchange_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">route</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">route</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                  <span class="n">new_route_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_cost_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Evaluation</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Instance</span><span class="p">,</span>
                       <span class="n">solution</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Solution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">split_route</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">route</span><span class="p">]</span>
        <span class="n">cost_of_first_route_after_split</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">evaluate_splice</span><span class="p">(</span><span class="n">evaluation</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">split_route</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_route</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cost_of_second_route_after_split</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">evaluate_splice</span><span class="p">(</span><span class="n">evaluation</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">split_route</span><span class="p">,</span>
                                                              <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

        <span class="n">original_route_cost</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">route</span><span class="p">]</span><span class="o">.</span><span class="n">cost</span>
        <span class="k">return</span> <span class="n">cost_of_first_route_after_split</span> <span class="o">+</span> <span class="n">cost_of_second_route_after_split</span> <span class="o">-</span> <span class="n">original_route_cost</span>


<span class="k">class</span> <span class="nc">SplitRouteOperator</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">LocalSearchOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Instance</span><span class="p">):</span>
        <span class="n">rb</span><span class="o">.</span><span class="n">LocalSearchOperator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">_increment_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Solution</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">NodeLocation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increments the given location to the next possible split location. Modifies the passed location in-place.</span>
<span class="sd">        Returns None if no further splits are possible.</span>
<span class="sd">        :param solution: The solution to be split</span>
<span class="sd">        :param location: The location to be incremented</span>
<span class="sd">        :return: The incremented location or None if the solution is exhausted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">location</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Move to the next route if the current one is exhausted</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="n">location</span><span class="o">.</span><span class="n">route</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">location</span><span class="o">.</span><span class="n">route</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">location</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># No further splits possible</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">route</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">location</span>

    <span class="k">def</span> <span class="nf">_recover_from_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Solution</span><span class="p">,</span> <span class="n">move</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SplitRouteMove</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rb</span><span class="o">.</span><span class="n">NodeLocation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recovers the state of the search from the given move.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If no move was given, start at the beginning</span>
        <span class="k">if</span> <span class="n">move</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rb</span><span class="o">.</span><span class="n">NodeLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Otherwise continue at the next location</span>
        <span class="n">next_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_increment_location</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">move</span><span class="o">.</span><span class="n">location</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">next_location</span>

    <span class="k">def</span> <span class="nf">finalize_search</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># No cleanup needed</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">prepare_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Solution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># No preparation needed</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">find_next_improving_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Evaluation</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Solution</span><span class="p">,</span>
                                 <span class="n">last_evaluated_move</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Move</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rb</span><span class="o">.</span><span class="n">Move</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_evaluated_move</span><span class="p">,</span> <span class="n">SplitRouteMove</span><span class="p">)</span> <span class="ow">or</span> <span class="n">last_evaluated_move</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">next_move_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recover_from_move</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">last_evaluated_move</span><span class="p">)</span>

        <span class="c1"># Iterate over all possible split locations</span>
        <span class="k">while</span> <span class="n">next_move_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">next_move</span> <span class="o">=</span> <span class="n">SplitRouteMove</span><span class="p">(</span><span class="n">next_move_location</span><span class="p">)</span>
            <span class="c1"># Evaluate the corresponding move</span>
            <span class="k">if</span> <span class="n">next_move</span><span class="o">.</span><span class="n">get_cost_delta</span><span class="p">(</span><span class="n">evaluation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e-2</span><span class="p">:</span>
                <span class="c1"># If the move is improving, return it</span>
                <span class="k">return</span> <span class="n">next_move</span>
            <span class="c1"># Otherwise continue with the next location</span>
            <span class="n">next_move_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_increment_location</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">next_move_location</span><span class="p">)</span>
        <span class="c1"># Terminate the search if no improving move was found</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>The signatures of the interfaces to implement are as follows:</p>
<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.LocalSearchOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">LocalSearchOperator</span></span><a class="headerlink" href="#routingblocks.LocalSearchOperator" title="Link to this definition"></a></dt>
<dd><p>Interface for implementing custom local search operators.</p>
<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.LocalSearchOperator.finalize_search">
<span class="sig-name descname"><span class="pre">finalize_search</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.LocalSearchOperator.finalize_search" title="Link to this definition"></a></dt>
<dd><p>Called after the search for improving moves has been completed.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.LocalSearchOperator.find_next_improving_move">
<span class="sig-name descname"><span class="pre">find_next_improving_move</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">evaluation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><span class="pre">Evaluation</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_evaluated_move</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><span class="pre">Move</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.LocalSearchOperator.find_next_improving_move" title="Link to this definition"></a></dt>
<dd><p>Finds the next improving move. Returns None if no improving move is found.
To avoid looping forever, this method should pick up the search where it left off, i.e., at last_evaluated_move.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>evaluation</strong> (<a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><em>Evaluation</em></a>) – The evaluation function to use.</p></li>
<li><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution to be improved.</p></li>
<li><p><strong>last_evaluated_move</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><em>Move</em></a><em>]</em>) – The last move that was evaluated. Note that this corresponds to the last Move this operator returned. None if no move has been evaluated yet.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The next improving move. None if no improving move is found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[<a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move">Move</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.LocalSearchOperator.prepare_search">
<span class="sig-name descname"><span class="pre">prepare_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.LocalSearchOperator.prepare_search" title="Link to this definition"></a></dt>
<dd><p>Called before the search for improving moves is started.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution to be improved.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.Move">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">Move</span></span><a class="headerlink" href="#routingblocks.Move" title="Link to this definition"></a></dt>
<dd><p>Interface for implementing custom moves.</p>
<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.Move.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="instance.html#routingblocks.Instance" title="routingblocks.Instance"><span class="pre">Instance</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.Move.apply" title="Link to this definition"></a></dt>
<dd><p>Applies the move to the solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instance</strong> (<a class="reference internal" href="instance.html#routingblocks.Instance" title="routingblocks.Instance"><em>Instance</em></a>) – The instance.</p></li>
<li><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution to be improved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.Move.get_cost_delta">
<span class="sig-name descname"><span class="pre">get_cost_delta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">evaluation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><span class="pre">Evaluation</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="instance.html#routingblocks.Instance" title="routingblocks.Instance"><span class="pre">Instance</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.Move.get_cost_delta" title="Link to this definition"></a></dt>
<dd><p>Returns the cost delta of the move according to the passed evaluation function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>evaluation</strong> (<a class="reference internal" href="adptw.html#routingblocks.adptw.Evaluation" title="routingblocks.adptw.Evaluation"><em>Evaluation</em></a>) – The evaluation function to use.</p></li>
<li><p><strong>instance</strong> (<a class="reference internal" href="instance.html#routingblocks.Instance" title="routingblocks.Instance"><em>Instance</em></a>) – The instance.</p></li>
<li><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="pivoting-rules">
<span id="id2"></span><h2>Pivoting rules<a class="headerlink" href="#pivoting-rules" title="Link to this heading"></a></h2>
<p>Pivoting rules implement pivoting strategies used by the local search solver.
For this purpose, they provide a method to select the next move to be applied to the solution,
and a method to determine if the search should continue or terminate. The former method is called right after the
search for improving moves terminates, either by exhausting the neighborhood or by the pivoting rule itself.
The latter method is called each time an improving move is found, and can terminate the search prematurely.</p>
<p>Custom pivoting rules can be implemented by subclassing <a class="reference internal" href="#routingblocks.PivotingRule" title="routingblocks.PivotingRule"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PivotingRule</span></code></a> and overriding the
<a class="reference internal" href="#routingblocks.PivotingRule.select_move" title="routingblocks.PivotingRule.select_move"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.PivotingRule.select_move()</span></code></a> and
<a class="reference internal" href="#routingblocks.PivotingRule.continue_search" title="routingblocks.PivotingRule.continue_search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.PivotingRule.continue_search()</span></code></a> methods. See <a class="reference internal" href="#custom-pivoting-rules"><span class="std std-ref">custom pivoting rules</span></a> for more details.</p>
<p>The following pivoting rules are provided by the routingblocks package:</p>
<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.BestImprovementPivotingRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">BestImprovementPivotingRule</span></span><a class="headerlink" href="#routingblocks.BestImprovementPivotingRule" title="Link to this definition"></a></dt>
<dd><p>The best improvement pivoting rule selects the best improving move found during the search for improving moves.
It never terminates the search prematurely.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.KBestImprovementPivotingRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">KBestImprovementPivotingRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.KBestImprovementPivotingRule" title="Link to this definition"></a></dt>
<dd><p>The k - best improvement pivoting rule selects best out of the first k improving moves found during the search
for improving moves. It terminates the search as soon as the k - th improving move is found.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>k</strong> (<em>int</em>) – The number of improving moves to consider.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.FirstImprovementPivotingRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">FirstImprovementPivotingRule</span></span><a class="headerlink" href="#routingblocks.FirstImprovementPivotingRule" title="Link to this definition"></a></dt>
<dd><p>The first improvement pivoting rule selects the first improving move found during the search for improving moves.
It terminates the search as soon as the first improving move is found.</p>
</dd></dl>

</section>
<section id="custom-pivoting-rules">
<span id="id3"></span><h2>Custom pivoting rules<a class="headerlink" href="#custom-pivoting-rules" title="Link to this heading"></a></h2>
<p>Custom pivoting rules can be implemented by subclassing <a class="reference internal" href="#routingblocks.PivotingRule" title="routingblocks.PivotingRule"><code class="xref py py-class docutils literal notranslate"><span class="pre">routingblocks.PivotingRule</span></code></a> and overriding the
<a class="reference internal" href="#routingblocks.PivotingRule.select_move" title="routingblocks.PivotingRule.select_move"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.PivotingRule.select_move()</span></code></a> and
<a class="reference internal" href="#routingblocks.PivotingRule.continue_search" title="routingblocks.PivotingRule.continue_search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">routingblocks.PivotingRule.continue_search()</span></code></a> methods.</p>
<p>Consider the following example, which implements best improvement with blinks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BestImprovementWithBlinksPivotingRule</span><span class="p">(</span><span class="n">routingblocks</span><span class="o">.</span><span class="n">PivotingRule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blink_probability</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">randgen</span><span class="p">:</span> <span class="n">routingblocks</span><span class="o">.</span><span class="n">Random</span><span class="p">):</span>
        <span class="n">routingblocks</span><span class="o">.</span><span class="n">PivotingRule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blink_probability</span> <span class="o">=</span> <span class="n">blink_probability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_randgen</span> <span class="o">=</span> <span class="n">randgen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_move</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_delta_cost</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e-2</span>

    <span class="k">def</span> <span class="nf">continue_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">found_improving_move</span><span class="p">:</span> <span class="n">routingblocks</span><span class="o">.</span><span class="n">Move</span><span class="p">,</span> <span class="n">delta_cost</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="n">solution</span><span class="p">:</span> <span class="n">routingblocks</span><span class="o">.</span><span class="n">Solution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delta_cost</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_delta_cost</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_best_move</span> <span class="o">=</span> <span class="n">found_improving_move</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_best_delta_cost</span> <span class="o">=</span> <span class="n">delta_cost</span>
            <span class="c1"># If we do not blink, we can stop the search. Otherwise we continue.</span>
            <span class="c1"># This ensures that we always return the best found move, even if only one is found and that one is blinked.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_randgen</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blink_probability</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">select_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">routingblocks</span><span class="o">.</span><span class="n">Solution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">routingblocks</span><span class="o">.</span><span class="n">Move</span><span class="p">]:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_move</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_move</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_delta_cost</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e-2</span>
        <span class="k">return</span> <span class="n">move</span>
</pre></div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="routingblocks.PivotingRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">routingblocks.</span></span><span class="sig-name descname"><span class="pre">PivotingRule</span></span><a class="headerlink" href="#routingblocks.PivotingRule" title="Link to this definition"></a></dt>
<dd><p>Interface for implementing custom pivoting rules.</p>
<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.PivotingRule.select_move">
<span class="sig-name descname"><span class="pre">select_move</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.PivotingRule.select_move" title="Link to this definition"></a></dt>
<dd><p>Return the move to be applied to the solution.Returns none if no move is found.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution to be improved.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The move to be applied to the solution.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[<a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move">Move</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="routingblocks.PivotingRule.continue_search">
<span class="sig-name descname"><span class="pre">continue_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">found_improving_move</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><span class="pre">Move</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta_cost</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solution</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><span class="pre">Solution</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routingblocks.PivotingRule.continue_search" title="Link to this definition"></a></dt>
<dd><p>Determine if the search should continue or terminate.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>found_improving_move</strong> (<a class="reference internal" href="#routingblocks.Move" title="routingblocks.Move"><em>Move</em></a>) – The move found to be improving.</p></li>
<li><p><strong>delta_cost</strong> (<em>float</em>) – The(exact) cost difference between the current solution and the solution after applying the move.</p></li>
<li><p><strong>solution</strong> (<a class="reference internal" href="solution.html#routingblocks.Solution" title="routingblocks.Solution"><em>Solution</em></a>) – The solution the move should be applied to.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the search should continue, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="evaluation.html" class="btn btn-neutral float-left" title="Evaluation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="exact_facility_placement.html" class="btn btn-neutral float-right" title="Exact replenishment facility placement" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 - 2023, Patrick Sean Klein.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>